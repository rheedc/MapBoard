<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC 
				"-//mybatis.org//DTD Mapper 3.0//EN" 
				"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
				
<!-- select m_id as id , m_password as pw, m_nick as nick  from member where m_id=user입력ID? and m_password=user입력PW; 를 만들어 보자 -->
<mapper namespace="board">
	<!-- ex)<select id="loginChk" parameterType="hmap" resultType="hmap"> -->

	<!-- 자주 사용되는 명령은 한번만 만들어 놓 는다. -->
	<sql id="selectBoard">
		bidx,
		b.userid,
		b.place_no,
		subject,
		comm,
		point,
		b.likecnt,
		readcnt,
		b.createdt,
		b.updatedt,
		b.status
	</sql>
	
	

	<!-- 1. 게시물 등록 : 파일은 별도로 만들기-->
	<insert id="insertBoard" parameterType="boardVO"><!-- fileBoard:mB의 alias -->
		INSERT 
			INTO
		board 
			(bidx,
			userid,
			place_no,
			subject,
			comm,
			point,
			createdt,
			
			status)
		VALUES  
			(board_seq.nextval,
			#{userid},
			6,
			#{subject},
			#{comm},
			#{point},
			SYSDATE,
			'Y')		
	</insert>

	
	<!-- 2-1. 해당 페이지에 보여줄 게시물 정보 구하기 질의 : 페이징 -->	
	<select id="boardList" resultType="boardVO" parameterType="boardVO">
		SELECT
			*
		FROM 
			(SELECT
				b.bidx,
				--f.file,
				b.userid,
				place_name,
				subject,
				comm,
				point,
				likecnt,
				readcnt,
				b.createdt,
				b.updatedt,
				b.status ,
				ROW_NUMBER() over(order by bidx asc) as rno
			from
		 		board b,place p--, fileinfo f
			where
				b.place_no=p.place_no
				--and b.bidx=f.bidx
				and UPPER(b.status)='Y'
				)
		where	
			rno 
		between 
			#{start} 
		and #{end}
	</select>

	<!-- 2-2. 게시물 수 구하기 -->
	<select id="totalCount" resultType="int">
		SELECT 
			COUNT(*) AS CNT
		FROM 
			board
		WHERE 
			UPPER(status)='Y'
	</select>
	
	
	<!-- 3-1. CLOB -->
	<resultMap id="clobView" type="boardVO">
		<!-- CLOB필드를 선언한다. --><!-- fb_Body는 body로 함 -->
		<result property="body" 	column="fb_Body"						
				jdbcType="CLOB"  javaType="java.lang.String"/>
	</resultMap>
	
	<!-- 3-2. 상세보기 질의 명령 -->
	<select id="boardView" resultMap="clobView" parameterType="boardVO">
		SELECT
			bidx,
			subject,
			b.userid,
			b.createdt,
			--f.file,
			comm,
			--m.map,
			place_name,
			point,
			readcnt,
			likecnt
		FROM
			board b,place p--, fileinfo f
		where
			b.place_no=p.place_no
			--and b.bidx=f.bidx
			and	bidx = #{bidx}
	</select>	
	
	<!-- 3-2. 조회수 증가 질의  -->
	<update id="updateHit"  parameterType="int">
		UPDATE
			board
		SET
			readcnt = readcnt + 1
		WHERE
			bidx = #{bidx}
	</update>
</mapper>